import{K as ae,r as o,j as e,L as S,$ as U,S as se}from"./app-Cwv6Lo2-.js";import{B as p}from"./button-BG3_co2O.js";import{C as re}from"./checkbox-BWz_PIiU.js";import{I as le}from"./input-B8dzbun5.js";import{L as B}from"./label-Ci7Sh583.js";import{S as O}from"./separator-Dmsd9J4o.js";import{T as ie,a as ne,b as H,c as I}from"./tabs-CDBx0gpY.js";import{U as _}from"./user-layout-H5nEYdGt.js";import{U as z}from"./user-Dq5QIm5W.js";import{B as G}from"./badge-check-CSzRHVzL.js";import{H as oe}from"./hourglass-Chztxarx.js";import{C as M}from"./check-BpJu_jyn.js";import{X as ce}from"./x-9KIiAHlk.js";/* empty css            */import"./index-BcPcoHHn.js";import"./index-Cdqb3fCE.js";import"./utils-5Gb2FoSy.js";import"./index-5nV_q3NW.js";import"./index-BNGqZOtg.js";import"./index-BSlbP0Zb.js";import"./index-BulgpOZn.js";import"./floating-ui.react-dom-BpB-JhDQ.js";import"./index-Dbyz5HzH.js";import"./index-C93NJCmq.js";import"./sonner-CCckcjiX.js";import"./index-Brw4gkQ-.js";import"./breadcrumbs-DQ6jcikc.js";import"./createLucideIcon-Bv6foRtC.js";import"./index-D6ai65Ao.js";import"./Combination-D_Skvxhp.js";import"./tooltip-C0fHRgeq.js";import"./index-vc770dL4.js";import"./dropdown-menu-CNd6xGxf.js";import"./index-8evVcJHK.js";import"./avatar-TAAMRDGt.js";import"./use-initials-CQaL3me1.js";import"./chevron-right-B6N1eNeM.js";import"./icon-CzQmg3IU.js";import"./chevron-down-xhVcV5_u.js";import"./popover-I3F7hmrS.js";import"./badge-DWSw9Oue.js";import"./command-DuuoLEx7.js";import"./dialog-CMN5qItO.js";import"./search-hS5aSloP.js";import"./circle-check-big-CY21J4OV.js";import"./clock-BGqytY1t.js";import"./monitor-play--kVwuPE-.js";import"./presentation-eCP7TAiz.js";import"./house-D5rrYIjj.js";import"./file-text-CMLC4YZt.js";function me(t){const c=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,n=t.match(c);return n&&n[2].length===11?n[2]:""}function de(t){if(!t)return[];const c=t.match(/<li>(.*?)<\/li>/g);return c?c.map(n=>n.replace(/<\/?li>/g,"").trim()):[]}function ot({course:t,hasAccess:c,pendingInvoiceUrl:n,referralInfo:m}){var K,R;const{auth:C}=ae().props,P=!!C.user,b=P&&((K=C.user)==null?void 0:K.phone_number),d=(R=t.modules)==null?void 0:R.flatMap(a=>a.lessons||[]).find(a=>a.type==="video"&&a.video_url),[y,$]=o.useState(!1),[L,h]=o.useState(!1),[x,q]=o.useState(""),[s,f]=o.useState(null),[T,A]=o.useState(!1),[k,u]=o.useState(""),X=de(t.key_points),i=t.price===0,N=5e3,Y=t.price,J=(s==null?void 0:s.discount_amount)||0,F=Y-J,E=i?0:F+N;o.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("ref");r?sessionStorage.setItem("referral_code",r):m.code&&sessionStorage.setItem("referral_code",m.code)},[m]),o.useEffect(()=>{if(!x.trim()||i){f(null),u("");return}const a=setTimeout(()=>{V()},500);return()=>clearTimeout(a)},[x]);const V=async()=>{var a;if(!(!x.trim()||i)){A(!0),u("");try{const l=await(await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content)||""},credentials:"same-origin",body:JSON.stringify({code:x,amount:t.price,product_type:"course",product_id:t.id})})).json();l.valid?(f(l),u("")):(f(null),u(l.message||"Kode promo tidak valid"))}catch{f(null),u("Terjadi kesalahan saat memvalidasi kode promo")}finally{A(!1)}}},Q=async()=>{try{const r=await(await fetch("/csrf-token",{method:"GET",credentials:"same-origin"})).json(),l=document.querySelector('meta[name="csrf-token"]');return l&&(l.content=r.token),r.token}catch(a){throw console.error("Failed to refresh CSRF token:",a),a}},W=a=>{if(a.preventDefault(),!b){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}h(!0),se.post(route("enroll.free"),{type:"course",id:t.id},{onError:r=>{console.log("Free enrollment errors:",r),alert(r.message||"Gagal mendaftar kelas gratis.")},onFinish:()=>{h(!1)}})},Z=async a=>{if(a.preventDefault(),!b){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!y&&!i){alert("Anda harus menyetujui syarat dan ketentuan!");return}if(h(!0),i)return W(a);const r=async(l=0)=>{var D;const ee=t.strikethrough_price>0?t.strikethrough_price-t.price:0,te=(s==null?void 0:s.discount_amount)||0,w={type:"course",id:t.id,discount_amount:ee+te,nett_amount:F,transaction_fee:N,total_amount:E};s!=null&&s.valid&&(w.discount_code_id=s.discount_code.id,w.discount_code_amount=s.discount_amount);try{const g=(D=document.querySelector('meta[name="csrf-token"]'))==null?void 0:D.content,v=await fetch(route("invoice.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":g||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(w)});if(v.status===419&&l<2)return console.log(`CSRF token expired, refreshing... (attempt ${l+1})`),await Q(),r(l+1);const j=await v.json();if(v.ok&&j.success)if(j.payment_url)window.location.href=j.payment_url;else throw new Error("Payment URL not received");else throw new Error(j.message||"Gagal membuat invoice.")}catch(g){throw console.error("Payment error:",g),g}};try{await r()}catch(l){alert(l.message||"Terjadi kesalahan saat proses pembayaran."),h(!1)}};if(!P){const a=window.location.href,r=route("login",{redirect:a});return e.jsxs(_,{children:[e.jsx(S,{title:"Login Required"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Daftar Kelas Online "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan login terlebih dahulu untuk mendaftar kelas online."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(z,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk mendaftar kelas online ini.",m.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(p,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:r,children:"Login"})}),e.jsx(p,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(U,{href:route("register",m.code?{ref:m.code}:{}),children:"Daftar"})})]})]})})]})}return b?e.jsxs(_,{children:[e.jsx(S,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:i?"Lanjutkan untuk mendapatkan akses gratis ke kelas ini.":"Silakan selesaikan pembayaran untuk mendaftar kelas."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3 lg:gap-6",children:[e.jsxs(ie,{defaultValue:"detail",className:"lg:col-span-2",children:[e.jsxs(ne,{children:[e.jsx(H,{value:"detail",children:"Detail Kelas"}),e.jsx(H,{value:"preview",children:"Preview Video"})]}),e.jsx(I,{value:"detail",children:e.jsxs("div",{className:"h-full rounded-lg border p-4",children:[e.jsx("h2",{className:"text-3xl font-bold italic",children:"Yang akan kamu pelajari"}),e.jsxs("p",{className:"mt-2 mb-4 text-sm text-gray-600",children:['Berikut adalah beberapa poin penting yang akan kamu pelajari dalam kelas "',t.title,'".']}),e.jsx("ul",{className:"space-y-2",children:X.map((a,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(G,{size:18,className:"mt-1 min-w-6 text-green-600"}),e.jsx("p",{className:"text-sm md:text-base",children:a})]},r))})]})}),e.jsx(I,{value:"preview",children:e.jsxs("div",{className:"h-full rounded-lg border p-4",children:[e.jsx("h2",{className:"text-3xl font-bold italic",children:"Preview Video"}),e.jsxs("p",{className:"mt-2 mb-4 text-sm text-gray-600",children:['Berikut adalah preview video dari kelas "',t.title,'". Silakan tonton untuk mendapatkan gambaran materi yang akan dipelajari.']}),e.jsx("div",{className:"aspect-video w-full",children:e.jsx("iframe",{width:"100%",height:"100%",src:d!=null&&d.video_url&&(d.video_url.includes("youtube.com")||d.video_url.includes("youtu.be"))?`https://www.youtube.com/embed/${me(d.video_url)}`:"",title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"h-full w-full rounded-xl"})})]})})]}),c?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(G,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah terdaftar di kelas ini. Silakan lanjutkan belajar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:`/profile/my-courses/${t.slug}`,children:"Masuk ke Kelas"})})]}):n?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(oe,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk kelas ini. Silakan lanjutkan untuk membayar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:n,children:"Lanjutkan Pembayaran"})})]}):e.jsxs("form",{onSubmit:Z,children:[e.jsxs("h2",{className:"my-2 text-xl font-bold italic",children:["Detail ",i?"Pendaftaran":"Pembayaran"]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[i?e.jsx("div",{className:"flex items-center justify-between p-4 text-center",children:e.jsx("span",{className:"w-full text-2xl font-bold text-green-600",children:"KELAS GRATIS"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"promo-code",children:"Kode Promo (Opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{id:"promo-code",type:"text",placeholder:"Masukkan kode promo",value:x,onChange:a=>q(a.target.value.toUpperCase()),className:"pr-10"}),T&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-blue-600"})}),!T&&x&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:s!=null&&s.valid?e.jsx(M,{className:"h-4 w-4 text-green-600"}):k?e.jsx(ce,{className:"h-4 w-4 text-red-600"}):null})]}),k&&e.jsx("p",{className:"text-sm text-red-600",children:k}),(s==null?void 0:s.valid)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{className:"text-sm font-medium text-green-800",children:['Kode promo "',s.discount_code.code,'" berhasil diterapkan!']})]}),e.jsxs("p",{className:"mt-1 text-xs text-green-600",children:[s.discount_code.name," - Diskon ",s.discount_code.formatted_value]})]})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border p-4",children:[t.strikethrough_price>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Asli"}),e.jsxs("span",{className:"font-semibold text-gray-500 line-through",children:["Rp ",t.strikethrough_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-Rp ",(t.strikethrough_price-t.price).toLocaleString("id-ID")]})]}),e.jsx(O,{className:"my-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Kelas"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",t.price.toLocaleString("id-ID")]})]}),(s==null?void 0:s.valid)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Diskon Promo (",s.discount_code.code,")"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-Rp ",s.discount_amount.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-semibold text-gray-500",children:["Rp ",N.toLocaleString("id-ID")]})]}),e.jsx(O,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-primary text-xl font-bold",children:["Rp ",E.toLocaleString("id-ID")]})]})]})]}),!i&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{id:"terms",checked:y,onCheckedChange:a=>$(a===!0)}),e.jsxs(B,{htmlFor:"terms",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(p,{className:"w-full",type:"submit",disabled:(i?!1:!y)||L,children:L?"Memproses...":i?"Dapatkan Akses Gratis Sekarang":"Lanjutkan Pembayaran"})]})]})]})})]}):e.jsxs(_,{children:[e.jsx(S,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(z,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk mendaftar kelas."}),e.jsx(p,{asChild:!0,className:"w-full max-w-md",children:e.jsx(U,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{ot as default};
