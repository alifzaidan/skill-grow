import{K as ee,r as c,j as e,L as _,$ as H,S as te}from"./app-CRg_Xi7F.js";import{B as p}from"./button-CO7UMu5l.js";import{C as se}from"./checkbox-uX-UK9GP.js";import{I as ae}from"./input-CNnLsfOD.js";import{L as U}from"./label-pDfcTgDY.js";import{S as M}from"./separator-CH7q4AU2.js";import{U as C}from"./user-layout-TXGo0F0N.js";import{U as O}from"./user-DBbBhhg7.js";import{B}from"./badge-check-D3XLBtJa.js";import{H as re}from"./hourglass-DfusoaU_.js";import{C as I}from"./check-BWXOrh8_.js";import{X as le}from"./x-BTDVe3Cx.js";/* empty css            */import"./index-DhgAJUHR.js";import"./index-B2vvonCY.js";import"./utils-DSFJYImB.js";import"./index-CxKfhM4B.js";import"./index-DPHI8qZB.js";import"./index-BTy3pc7Q.js";import"./index-KBZ76fOw.js";import"./floating-ui.react-dom-Bed5HHww.js";import"./index-iIghCdK0.js";import"./index-r-xxwlQK.js";import"./sonner-BffIn_Nq.js";import"./index-DyKbzeLR.js";import"./breadcrumbs-C0Q437Qq.js";import"./createLucideIcon--u4GSplZ.js";import"./index-ChpY92LQ.js";import"./Combination-BIrHtPJD.js";import"./tooltip-COOIB2d_.js";import"./index-CnJ8OYfM.js";import"./dropdown-menu-8trEGD1b.js";import"./index-DUDodHBe.js";import"./avatar-BLW4S8VZ.js";import"./use-initials-BnIp3qPh.js";import"./chevron-right-DqcWdJf3.js";import"./icon-CaeTLCoP.js";import"./badge--bzs_jy0.js";import"./command-Bqgm5jQv.js";import"./dialog-BMgivqJp.js";import"./search-BqQLeTBK.js";import"./circle-check-big-CKeBNmOO.js";import"./clock-DsZbbzmu.js";import"./house-DN-HeGuX.js";import"./monitor-play-CujVDQ6y.js";import"./presentation-BJfTQxfo.js";function ne(t){const m=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,i=t.match(m);return i&&i[2].length===11?i[2]:""}function ie(t){if(!t)return[];const m=t.match(/<li>(.*?)<\/li>/g);return m?m.map(i=>{const o=i.replace(/<\/?li>/g,"").trim(),u=document.createElement("textarea");return u.innerHTML=o,u.value}):[]}function et({course:t,hasAccess:m,pendingInvoiceUrl:i,referralInfo:o}){var R,K;const{auth:u}=ee().props,L=!!u.user,y=L&&((R=u.user)==null?void 0:R.phone_number),d=(K=t.modules)==null?void 0:K.flatMap(s=>s.lessons||[]).find(s=>s.type==="video"&&s.video_url),[N,z]=c.useState(!1),[P,f]=c.useState(!1),[x,G]=c.useState(""),[a,g]=c.useState(null),[A,T]=c.useState(!1),[k,h]=c.useState(""),$=ie(t.key_points),n=t.price===0,w=5e3,q=t.price,X=(a==null?void 0:a.discount_amount)||0,F=q-X,E=n?0:F+w;c.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("ref");r?sessionStorage.setItem("referral_code",r):o.code&&sessionStorage.setItem("referral_code",o.code)},[o]),c.useEffect(()=>{if(!x.trim()||n){g(null),h("");return}const s=setTimeout(()=>{J()},500);return()=>clearTimeout(s)},[x]);const J=async()=>{var s;if(!(!x.trim()||n)){T(!0),h("");try{const l=await(await fetch("/api/discount-codes/validate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content)||""},credentials:"same-origin",body:JSON.stringify({code:x,amount:t.price,product_type:"course",product_id:t.id})})).json();l.valid?(g(l),h("")):(g(null),h(l.message||"Kode promo tidak valid"))}catch{g(null),h("Terjadi kesalahan saat memvalidasi kode promo")}finally{T(!1)}}},V=async()=>{try{const r=await(await fetch("/csrf-token",{method:"GET",credentials:"same-origin"})).json(),l=document.querySelector('meta[name="csrf-token"]');return l&&(l.content=r.token),r.token}catch(s){throw console.error("Failed to refresh CSRF token:",s),s}},Y=s=>{if(s.preventDefault(),!y){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}f(!0),te.post(route("enroll.free"),{type:"course",id:t.id},{onError:r=>{console.log("Free enrollment errors:",r),alert(r.message||"Gagal mendaftar kelas gratis.")},onFinish:()=>{f(!1)}})},W=async s=>{if(s.preventDefault(),!y){alert("Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu."),window.location.href=route("profile.edit");return}if(!N&&!n){alert("Anda harus menyetujui syarat dan ketentuan!");return}if(f(!0),n)return Y(s);const r=async(l=0)=>{var D;const Q=t.strikethrough_price>0?t.strikethrough_price-t.price:0,Z=(a==null?void 0:a.discount_amount)||0,v={type:"course",id:t.id,discount_amount:Q+Z,nett_amount:F,transaction_fee:w,total_amount:E};a!=null&&a.valid&&(v.discount_code_id=a.discount_code.id,v.discount_code_amount=a.discount_amount);try{const j=(D=document.querySelector('meta[name="csrf-token"]'))==null?void 0:D.content,S=await fetch(route("invoice.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":j||"",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(v)});if(S.status===419&&l<2)return console.log(`CSRF token expired, refreshing... (attempt ${l+1})`),await V(),r(l+1);const b=await S.json();if(S.ok&&b.success)if(b.payment_url)window.location.href=b.payment_url;else throw new Error("Payment URL not received");else throw new Error(b.message||"Gagal membuat invoice.")}catch(j){throw console.error("Payment error:",j),j}};try{await r()}catch(l){alert(l.message||"Terjadi kesalahan saat proses pembayaran."),f(!1)}};if(!L){const s=window.location.href,r=route("login",{redirect:s});return e.jsxs(C,{children:[e.jsx(_,{title:"Login Required"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Daftar Kelas Online "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan login terlebih dahulu untuk mendaftar kelas online."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(O,{size:64,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Login Diperlukan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Anda perlu login terlebih dahulu untuk mendaftar kelas online ini.",o.hasActive&&" Kode referral Anda akan tetap tersimpan."]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsx(p,{asChild:!0,className:"flex-1",children:e.jsx("a",{href:r,children:"Login"})}),e.jsx(p,{asChild:!0,variant:"outline",className:"flex-1",children:e.jsx(H,{href:route("register",o.code?{ref:o.code}:{}),children:"Daftar"})})]})]})})]})}return y?e.jsxs(C,{children:[e.jsx(_,{title:"Checkout Kelas"}),e.jsx("section",{className:"min-h-screen w-full bg-gradient-to-br from-yellow-50 via-white to-blue-50 px-2 py-8",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-col gap-8 lg:flex-row",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-6 rounded-2xl border bg-white/80 p-6 shadow-lg md:flex-row",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"mb-2 text-3xl font-bold text-black italic",children:t.title}),e.jsx("p",{className:"mb-2 line-clamp-3 text-gray-600",children:t.description}),e.jsxs("div",{className:"mb-2 flex flex-wrap gap-2",children:[e.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs font-semibold text-green-700 uppercase",children:t.level}),n&&e.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs font-semibold text-green-700 uppercase",children:"Gratis"})]}),e.jsx("ul",{className:"mt-4 space-y-2",children:$.map((s,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(B,{size:18,className:"mt-1 min-w-6 text-green-600"}),e.jsx("p",{className:"text-sm md:text-base",children:s})]},r))})]})}),e.jsxs("div",{className:"rounded-2xl border bg-white/80 p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-2 text-xl font-bold text-black",children:"Preview Video"}),e.jsx("div",{className:"aspect-video w-full overflow-hidden rounded-xl bg-gray-200",children:d!=null&&d.video_url&&(d.video_url.includes("youtube.com")||d.video_url.includes("youtu.be"))?e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${ne(d.video_url)}`,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"h-full w-full"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("p",{className:"mt-2 text-sm",children:"Video preview tidak tersedia"})]})})})]})]}),e.jsx("div",{className:"w-full flex-shrink-0 lg:w-[400px]",children:e.jsx("div",{className:"sticky top-8 flex flex-col gap-4 rounded-2xl border-2 border-blue-100 bg-white/90 p-6 shadow-2xl",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(B,{size:64,className:"text-green-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Anda Sudah Memiliki Akses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda sudah terdaftar di kelas ini. Silakan lanjutkan belajar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:`/profile/my-courses/${t.slug}`,children:"Masuk ke Kelas"})})]}):i?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(re,{size:64,className:"text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Tertunda"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Anda memiliki pembayaran yang belum selesai untuk kelas ini. Silakan lanjutkan untuk membayar."}),e.jsx(p,{asChild:!0,className:"w-full",children:e.jsx("a",{href:i,children:"Lanjutkan Pembayaran"})})]}):e.jsxs("form",{onSubmit:W,className:"flex flex-col gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-black italic",children:"Ringkasan Pembayaran"}),n?e.jsx("div",{className:"flex items-center justify-between p-4 text-center",children:e.jsx("span",{className:"w-full text-2xl font-bold text-green-600",children:"KELAS GRATIS"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"promo-code",children:"Kode Promo (Opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{id:"promo-code",type:"text",placeholder:"Masukkan kode promo",value:x,onChange:s=>G(s.target.value.toUpperCase()),className:"w-full pr-10"}),A&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-b-2 border-blue-600"})}),!A&&x&&e.jsx("div",{className:"absolute top-1/2 right-3 -translate-y-1/2 transform",children:a!=null&&a.valid?e.jsx(I,{className:"h-4 w-4 text-green-600"}):k?e.jsx(le,{className:"h-4 w-4 text-red-600"}):null})]}),k&&e.jsx("p",{className:"text-sm text-red-600",children:k}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{className:"text-sm font-medium text-green-800",children:['Kode promo "',a.discount_code.code,'" berhasil diterapkan!']})]}),e.jsxs("p",{className:"mt-1 text-xs text-green-600",children:[a.discount_code.name," - Diskon ",a.discount_code.formatted_value]})]})]}),e.jsxs("div",{className:"space-y-2 rounded-lg border bg-blue-50/50 p-4",children:[t.strikethrough_price>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Asli"}),e.jsxs("span",{className:"font-semibold text-gray-500 line-through",children:["Rp ",t.strikethrough_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Diskon"}),e.jsxs("span",{className:"font-semibold text-red-500",children:["-Rp ",(t.strikethrough_price-t.price).toLocaleString("id-ID")]})]}),e.jsx(M,{className:"my-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Harga Kelas"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Rp ",t.price.toLocaleString("id-ID")]})]}),(a==null?void 0:a.valid)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Diskon Promo (",a.discount_code.code,")"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-Rp ",a.discount_amount.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Biaya Transaksi"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Rp ",w.toLocaleString("id-ID")]})]}),e.jsx(M,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-black",children:"Total Pembayaran"}),e.jsxs("span",{className:"text-xl font-bold text-black",children:["Rp ",E.toLocaleString("id-ID")]})]})]})]}),!n&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{id:"terms",checked:N,onCheckedChange:s=>z(s===!0)}),e.jsxs(U,{htmlFor:"terms",className:"text-sm",children:["Saya menyetujui"," ",e.jsx("a",{href:"/terms-and-conditions",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:underline",children:"syarat dan ketentuan"})]})]}),e.jsx(p,{className:"mt-2 w-full",type:"submit",disabled:(n?!1:!N)||P,children:P?"Memproses...":n?"Dapatkan Akses Gratis Sekarang":"Lanjutkan Pembayaran"})]})})})]})})]}):e.jsxs(C,{children:[e.jsx(_,{title:"Checkout Kelas"}),e.jsx("section",{className:"to-primary w-full bg-gradient-to-tl from-black px-4",children:e.jsxs("div",{className:"mx-auto my-12 w-full max-w-7xl px-4",children:[e.jsxs("h2",{className:"mx-auto mb-4 max-w-3xl bg-gradient-to-r from-[#71D0F7] via-white to-[#E6834A] bg-clip-text text-center text-3xl font-bold text-transparent italic sm:text-4xl",children:['Checkout Kelas "',t.title,'"']}),e.jsx("p",{className:"text-center text-gray-400",children:"Silakan lengkapi profil Anda terlebih dahulu."})]})}),e.jsx("section",{className:"mx-auto my-4 w-full max-w-7xl px-4",children:e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-4 rounded-lg border p-6 text-center",children:[e.jsx(O,{size:64,className:"text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"Profil Belum Lengkap"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Profil Anda belum lengkap! Harap lengkapi nomor telepon terlebih dahulu untuk mendaftar kelas."}),e.jsx(p,{asChild:!0,className:"w-full max-w-md",children:e.jsx(H,{href:route("profile.edit",{redirect:window.location.href}),children:"Lengkapi Profil"})})]})})]})}export{et as default};
